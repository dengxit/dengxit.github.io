<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Sql-mode :ONLY_FULL_GROUP_BY</title>
    <url>/2020/03/20/sqlmode-only-full-group-by/</url>
    <content><![CDATA[<h5 id="ONLY-FULL-GROUP-BY-引起的一个问题"><a href="#ONLY-FULL-GROUP-BY-引起的一个问题" class="headerlink" title="ONLY_FULL_GROUP_BY 引起的一个问题"></a>ONLY_FULL_GROUP_BY 引起的一个问题</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Column &#39;XXXX&#39; is invalid in the select list because it is not contained in </span></pre></td></tr><tr><td class="code"><pre><span class="line">either an aggregate function or the GROUP BY clause.</span></pre></td></tr></table></figure>
<p>这是由于Mysql的 Sql-mode 设置ONLY_FULL_GROUP_BY导致的，在解决这个问题前首先要了解Mysql的Sql-mode</p>
<h5 id="Sql-mode-介绍"><a href="#Sql-mode-介绍" class="headerlink" title="Sql-mode 介绍"></a>Sql-mode 介绍</h5><ul>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html#sql-mode-changes" target="_blank" rel="noopener">MySql 5.7 Sql-mode</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/group-by-handling.html" target="_blank" rel="noopener">MySql Handling of GROUP BY</a></li>
</ul>
<h6 id="在文档中我们可以看到"><a href="#在文档中我们可以看到" class="headerlink" title="在文档中我们可以看到"></a>在文档中我们可以看到</h6><p>以下的Sql语句在ONLY_FULL_GROUP_BY模式下会出错</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT name, address, MAX(age) FROM t GROUP BY name;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">ERROR 1055 (42000): Expression #2 of SELECT list is not in GROUP</span></pre></td></tr><tr><td class="code"><pre><span class="line">BY clause and contains nonaggregated column &#39;mydb.t.address&#39; which</span></pre></td></tr><tr><td class="code"><pre><span class="line">is not functionally dependent on columns in GROUP BY clause; this</span></pre></td></tr><tr><td class="code"><pre><span class="line">is incompatible with sql_mode&#x3D;ONLY_FULL_GROUP_BY</span></pre></td></tr></table></figure>
<p>原因是 address 没有位于 GROUP BY 列中，也没有使用聚合函数；但是如果 name 是t表的主键或者是唯一的NOT NULL 列，那么这个查询是有效的，因为Mysql可以认识到select所选择的列在功能上取决于group by的列，name若为主键，则它可以确定唯一的对应address，这样就不会产生随机性。</p>
<h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><ul>
<li>确定业务逻辑上 name 对应唯一的 address 可以使用 ANY_VALUE</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT name, ANY_VALUE(address), MAX(age) FROM t GROUP BY name;</span></pre></td></tr></table></figure>

<ul>
<li><p>根据业务逻辑可以 为 address 这样的字段 加上聚合函数</p>
</li>
<li><p>关闭 ONLY_FULL_GROUP_BY。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT @@sql_mode;</span></pre></td></tr><tr><td class="code"><pre><span class="line">SET sql_mode &#x3D;&#39;xxxxxx,xxxxxx&#39; #去除ONLY_FULL_GROUP_BY</span></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>使用Vultr搭建Vpn</title>
    <url>/2019/12/01/Vultr/</url>
    <content><![CDATA[<h4 id="注册Vultr"><a href="#注册Vultr" class="headerlink" title="注册Vultr"></a>注册Vultr</h4><ul>
<li><a href="https://www.vultr.com/?ref=8334405" target="_blank" rel="noopener">Vultr</a><h4 id="购买服务器"><a href="#购买服务器" class="headerlink" title="购买服务器"></a>购买服务器</h4></li>
<li>Cloud compute</li>
<li>Tokyo</li>
<li>Centos 7x64</li>
<li>$5/mo<h4 id="部署-Deploy-Now"><a href="#部署-Deploy-Now" class="headerlink" title="部署 Deploy Now"></a>部署 Deploy Now</h4></li>
</ul>
<h4 id="使用vultr搭建ss服务器"><a href="#使用vultr搭建ss服务器" class="headerlink" title="使用vultr搭建ss服务器"></a>使用vultr搭建ss服务器</h4><ul>
<li>ssh登陆服务器</li>
<li>安装shadowsocks<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget –no-check-certificate -O shadowsocks.sh https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;teddysun&#x2F;shadowsocks_install&#x2F;master&#x2F;shadowsocks.sh</span></pre></td></tr></table></figure></li>
<li>获取 shadowsocks.sh 读取权限<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod +x shadowsocks.sh</span></pre></td></tr></table></figure></li>
<li>设置密码和端口<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;shadowsocks.sh 2&gt;&amp;1 | tee shadowsocks.log</span></pre></td></tr></table></figure></li>
<li>使用aes-256-cfb加密模式</li>
<li>之后就可以看到Vpn信息</li>
</ul>
<h4 id="使用Shadowsocks"><a href="#使用Shadowsocks" class="headerlink" title="使用Shadowsocks"></a>使用Shadowsocks</h4><ul>
<li><p><a href="https://github.com/shadowsocks/ShadowsocksX-NG/releases" target="_blank" rel="noopener">Shadowsocks Mac os</a></p>
</li>
<li><p>shadowsocks添加服务器设置</p>
</li>
</ul>
<ul>
<li><a href="https://wistbean.github.io/vultr-vps-bbr-ss.html" target="_blank" rel="noopener">文章参考</a></li>
</ul>
]]></content>
      <tags>
        <tag>教程</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2019/12/01/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
</search>
